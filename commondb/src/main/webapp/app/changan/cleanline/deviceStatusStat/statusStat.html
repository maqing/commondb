<!DOCTYPE html>
<html>
  <head>
      <meta charset="UTF-8"/>
      <title>后处理单元-设备运行状态</title>
      <link rel="stylesheet" href="/css/bootstrap.min.css">
      <link rel="stylesheet" href="/css/font-awesome.min.css">
      <link rel="stylesheet" href="/css/system.css">
      <style>
          body{
              overflow-y: auto;
          }
      </style>
      
      <script type="text/javascript" src="../_lib/jquery-1.11.1.min.js"></script>
      <script type="text/javascript" src="../_lib/system.js"></script>
      <script type="text/javascript" src="/lib/echarts/echarts-all.js"></script>
      <script type="text/javascript" src="../_lib/echart.js"></script>
      <script type="text/javascript" src="../_lib/My97DatePicker/WdatePicker.js"></script>
      <script type="text/javascript" src="../_lib/dateTool.js"></script>
      <script type="text/javascript">
         $(function(){
        	 
        	 $("#timeBegin").val(GetDateStr(-10));
        	 $("#timeEnd").val(GetDateStr(1));
        	 
        	 $("#equpTypeTimeBegin").val(GetDateStr(-10));
        	 $("#equpTypeTimeEnd").val(GetDateStr(1));
        	 
        	 
        	 var checkedArray = new Array();
        	 for(var i = 1;i <= 5;i++){
        		 checkedArray.push(i);
        	 }
        	 $("#apply6").addClass("nav_cur");
        	 $("#statMenu26").addClass("left_nav_cur");
        	 
        	 
        	 //init equipment drop list
        	 $.ajax({
     			url: '/app/deviceStatusStat/queryDevice.ac',
     			type: 'post',
     			dataType: 'json',
     			error: function(){alert('error');},
     			success:function(data){
     				if(null != data && null != data.deviceItemList){
     					var device = data.deviceItemList;
     					var option = "";
     					for(var i = 0 ;i < device.length;i++){
     						option +=  "<span id="+device[i].deviceId+">"+ device[i].deviceName;
     						option +=  "</span>";
     					}
     					$("#equip").html(option);
     					oSystem.select_sub();
     				}
     			}
     		});
        	 // init equipment type drop list from json file
        	$.getJSON("../_lib/equpType.json",function(data){
        		var option = "<span id='-1'>设备类型</span>";
        		$.each(data,function(infoIndex,info){
        			option += "<span id="+info["id"]+">" + info["name"];
        			option += "</span>";
        		});
        		$(".sub_pop_EqupType").html(option);
        		
        	});
        	 
        	//basic status search
        	$("#basicSearch").click(function(){
        		$("#totalRunTime").text(0);
				$("#normalRunTime").text(0);
				$("#standbyTime").text(0);
				$("#totalErrorTime").text(0);
        		var params = {
        				deviceId : $("#equitId").val(),
        				timeBegin: $("#timeBegin").val(),
        				timeEnd:   $("#timeEnd").val()
        		};
        		$.post('/app/deviceStatusStat/querySum.ac',params,function(data){
        			$("#totalRunTime").text(data.deviceWorkTimeItem.totalRunTime);
    				$("#normalRunTime").text(data.deviceWorkTimeItem.normalRunTime);
    				$("#standbyTime").text(data.deviceWorkTimeItem.standbyTime);
    				$("#totalErrorTime").text(data.deviceWorkTimeItem.totalErrorTime);
    				if(data.deviceWorkTimeItem.deviceOEE == "NaN"){
    					$("#deviceOEE").text(0);
    				}else{
    					$("#deviceOEE").text(100 * data.deviceWorkTimeItem.deviceOEE);
    				}
        		});
        	});
        	// 全选复选框
            $("#allChkY").click(function(){
            	checkedArray = new Array();
            	var chkStr = "#Chk";
            	for(var i = 1;i <= 5;i++){
            		$(chkStr+i+"Y").hide();
            		$(chkStr+i+"N").show();
            		if(checkedArray.indexOf(i) != -1){
            			checkedArray.splice($.inArray(i,checkedArray),1);
            		}
            	}
            	$("#allChkY").hide();
            	$("#allChkN").show();
            });
            $("#allChkN").click(function(){
            	var chkStr = "#Chk";
            	for(var i = 1;i <= 5;i++){
            		$(chkStr+i+"N").hide();
            		$(chkStr+i+"Y").show();
            		if(checkedArray.indexOf(i) < 0){
            			checkedArray.push(i);
            		}
            	}
            	$("#allChkN").hide();
            	$("#allChkY").show();
            });
            //选择复选框
            $(document).click(function(){
            	var checkedId = event.srcElement.id;
            	var checkStr = "#Chk";
            	if(checkedId.indexOf("Chk") != -1){
            		for(var i = 1 ; i <= 5 ; i++){
                		if(checkedId == ("Chk"+i+"Y")){
                			$(checkStr+i+"Y").hide();
                			$(checkStr+i+"N").show();
                			$("#allChkY").hide();
                      		$("#allChkN").show();
                      		checkedArray.splice($.inArray(i,checkedArray),1);
                		}else if(checkedId == ("Chk"+i+"N")){
                			$(checkStr+i+"N").hide();
                			$(checkStr+i+"Y").show();
                			checkedArray.push(i);
                		}
                		
                	}
                	if(checkedArray.length == 5){
                		$("#allChkN").hide();
                  		$("#allChkY").show();
                	}
            	}
            	
            	
            });
            
            //展现图表
        	$("#equpType").click(function(){
        		var equpParams = {
        				deviceType : $("#equipTypeId").val(),
        				timeBegin  : $("#equpTypeTimeBegin").val(),	
        				timeEnd    : $("#equpTypeTimeEnd").val()
        		};
        		
        		$.getJSON("../_lib/equpType.json",function(data){
            		$.each(data,function(infoIndex,info){
            			if(info["id"] == equpParams.deviceType){
              				$("#deviceNameId").text(info["name"]);
              			}
            		});
            		
            	});
        		
        		$("#pouBegin").text(equpParams.timeBegin);
                $("#pouEnd").text(equpParams.timeEnd);
        		
        		var totalRuntimeChart = echarts.init(document.getElementById("totalRuntimeChart")); 
        		var normalRunTimeChart = echarts.init(document.getElementById("normalRunTimeChart")); 
        		var standbyTimeChart = echarts.init(document.getElementById("standbyTimeChart"));
        		var totalErrorTimeChart = echarts.init(document.getElementById("totalErrorTimeChart"));
        		$.post('/app/deviceStatusStat/queryDeviceTypeStat.ac',equpParams,function(data){
        			var arryX = new Array();
        			var totalRunTimeArryY = new Array();
        			var normalRunTimeArryY = new Array();
        			var standbyTimeArryY = new Array();
        			var totalErrorTimeArryY = new Array();
        			
        			$.each(data.deviceWorkTimeList,function(i,info){
        				arryX.push(info.deviceName);
    					totalRunTimeArryY.push(info.totalRunTime);
    					normalRunTimeArryY.push(info.normalRunTime);
    					standbyTimeArryY.push(info.standbyTime);
    					totalErrorTimeArryY.push(info.totalErrorTime);
        			});
        			if(checkedArray.length == 5 || $("#allChkN").is(":hidden")){
        				$("#totalRuntimeChart").show();
        				chartsTool(totalRuntimeChart,"总运行时间",arryX,totalRunTimeArryY);
        				chartsTool(normalRunTimeChart,"正常运行时间",arryX,normalRunTimeArryY);
        				chartsTool(standbyTimeChart,"待机时间",arryX,standbyTimeArryY);
        				chartsTool(totalErrorTimeChart,"总故障时间",arryX,totalErrorTimeArryY);
        			}else{
        				if(checkedArray.indexOf(1) != -1){
        					$("#totalRuntimeChart").show();
        					chartsTool(totalRuntimeChart,"总运行时间",arryX,totalRunTimeArryY);
        				}else{
        					$("#totalRuntimeChart").hide();
        				}
        				if(checkedArray.indexOf(2) != -1){
        					chartsTool(normalRunTimeChart,"正常运行时间",arryX,normalRunTimeArryY);
        				}
        				if(checkedArray.indexOf(3) != -1){
        					chartsTool(standbyTimeChart,"待机时间",arryX,standbyTimeArryY);
        				}
        				if(checkedArray.indexOf(4) != -1){
        					chartsTool(totalErrorTimeChart,"总故障时间",arryX,totalErrorTimeArryY);
        				}
        			}
        			
        			
        		});
        		
        	});
        	
            //导出数据
        	$("#export").click(function(){
        		window.location.href= '/app/deviceStatusStat/queryDeviceTypeStatExport.ac?deviceType='+$("#equipTypeId").val()
        				+'&timeBegin='+$("#equpTypeTimeBegin").val() + '&timeEnd=' + $("#equpTypeTimeEnd").val();
        		
        	});
        	
        	
         });
         
      </script>
      

  </head>
  <body>
  <!--top start-->
     #parse("/app/header.vm")
  <!--top end-->

  <!--main start-->
  <div class="main">
      <div class="left fl">
          <!-- left menu start -->
          #parse("/app/newmenu.vm")
          <!-- left menu end -->
          <div class="left_r fr">
              <div class="location">后处理单元 > <span>设备运行状态统计</span></div>
              <div class="basic_query">
                  <h4 class="basic_t">基本运行状态查询</h4>
                  <div class="basic_c" style="width: 700px;">
                      <div class="basic_select">
                          <span class="basic_val">生产线</span>
                          <i class="fa fa-angle-down"></i>
                          <div class="sub_pop" id="line">
                              <span>生产线1</span>
                              <span>生产线2</span>
                              <span>生产线3</span>
                          </div>
                      </div>
                      <div class="basic_select" style="width: 160px;">
                          <span class="basic_val" >设备</span>
                          <input type="hidden" value="" id="equitId">
                          <i class="fa fa-angle-down"></i>
                          <div class="sub_pop" id="equip">
                          </div>
                      </div>

                      <div class="date">
                          <span class="date_t">日期选择</span>
                          <input type="text" class="date_wrap tcalInput" onfocus="WdatePicker();" id="timeBegin" />
                              <!--<span>2016-08-15</span>
                              <i class="fa fa-calendar"></i>-->
                          <span class="zhi">到</span>
                          <input type="text" class="date_wrap tcalInput" onfocus="WdatePicker();" id="timeEnd"/>
                          <!--<div class="date_wrap">
                              <span>2016-08-15</span>
                              <i class="fa fa-calendar"></i>
                          </div>-->
                      </div>
                  </div>
                  <div class="search"><span class="search_btn" id="basicSearch">查询</span> </div>
                  <div class="search_result">
                      <ul class="result_list">
                          <li>
                              <span><font id="totalRunTime">0</font><em>h</em></span>
                              <strong>总运行时间</strong>
                          </li>
                          <li>
                              <span><font id="normalRunTime">0</font><em>h</em></span>
                              <strong>正常运行时间</strong>
                          </li>
                          <li>
                              <span><font id="standbyTime">0</font><em>h</em></span>
                              <strong>待机时间</strong>
                          </li>
                          <li>
                              <span><font id="totalErrorTime">0</font><em>h</em></span>
                              <strong>总故障时间</strong>
                          </li>
                          <li>
                              <span><font id="deviceOEE">0</font><em>%</em></span>
                              <strong>设备OEE</strong>
                          </li>
                      </ul>
                  </div>

              </div>
              <!--设备状态对比 start-->
              <div class="basic_query">
                  <h4 class="basic_t">设备状态对比</h4>
                  <div class="basic_c">
                      <div class="basic_select_EqupType">
                          <span class="basic_val_EqupType">设备类型</span>
                          <input type="hidden" id="equipTypeId" value=""/>
                          <i class="fa fa-angle-down"></i>
                          <div class="sub_pop_EqupType">
                          </div>
                      </div>

                      <div class="date">
                          <span class="date_t">日期选择</span>
                          <input type="text" class="date_wrap tcalInput" onfocus="WdatePicker();" id="equpTypeTimeBegin" name="equpTypeTimeBegin" />
                          <!--<span>2016-08-15</span>
                          <i class="fa fa-calendar"></i>-->
                          <span class="zhi">到</span>
                          <input type="text" class="date_wrap tcalInput" onfocus="WdatePicker();" id="equpTypeTimeEnd" name="equpTypeTimeEnd" />
                          <!--<div class="date_wrap">
                              <span>2016-08-15</span>
                              <i class="fa fa-calendar"></i>
                          </div>-->
                      </div>
                  </div>
                  <div class="item clearfix">
                      <div class="item_l">对比项</div>
                      <div class="item_r">
                          <div class="item_r_t">
                              <i class="fa fa-square-o" id="allChkN" style="display: none"></i>
                              <i class="fa fa-check-square" id="allChkY"></i>
                              <span>以下全选</span>
                          </div>
                          <div class="item_r_b">
                              <i class="fa fa-square-o"  id="Chk1N" style="display: none"></i>
                              <i class="fa fa-check-square" id="Chk1Y"></i>
                              <span>总运行时间</span>
                              <i class="fa fa-square-o" id="Chk2N" style="display: none"></i>
                              <i class="fa fa-check-square" id="Chk2Y" ></i>
                              <span>正常运行时间</span>
                              <i class="fa fa-square-o" id="Chk3N" style="display: none"></i>
                              <i class="fa fa-check-square" id="Chk3Y"></i>
                              <span>待机时间</span>
                              <i class="fa fa-square-o" id="Chk4N" style="display: none"></i>
                              <i class="fa fa-check-square" id="Chk4Y"></i>
                              <span>总故障时间</span>
                              <i class="fa fa-square-o" id="Chk5N" style="display: none"></i>
                              <i class="fa fa-check-square" id="Chk5Y"></i>
                              <span>设备OEE</span>
                          </div>
                      </div>
                  </div>
                  <div class="search"><span class="search_btn pop_btn" id="equpType">查询</span> </div>
              </div>
              <!--设备状态对比 end-->

          </div>
      </div>
      <div class="right fr">
          <h4 class="help">帮助</h4>
          <ul class="help_list">
              <li>该页面是用来统计设备运行状态</li>
          </ul>
      </div>
  </div>

  <!--main end-->

  <!--popUp 弹出层 start-->
    <div id="mask"></div>
    <div class="popUp">
        <div class="popUp_t">设备状态对比结果<div class="close_t"><i class="fa fa-close"></i> </div> </div>
        <div class="popUp_c">
            <div class="popUp_c_t clearfix">
                <div class="popUp_c_l">
                    <div class="category">
                        <label class="cate">设备种类</label>
                        <span id="deviceNameId"></span>
                        <em>日期</em>
                        <span id="pouBegin"></span>
                        <em>到</em>
                        <span id="pouEnd"></span>
                    </div>
                    <div class="contrast">
                        <label class="contrast_t">对比项</label>
                        <i class="fa fa-check-square"></i>
                        <span>总运行时间</span>
                        <i class="fa fa-check-square"></i>
                        <span>正常运行时间</span>
                        <i class="fa fa-check-square"></i>
                        <span>待机时间</span>
                        <i class="fa fa-check-square"></i>
                        <span>总故障时间</span>
                        <i class="fa fa-check-square"></i>
                        <span>设备OEE</span>
                    </div>
                </div>
                <div class="popUp_c_t_r fr">
                    <a class="export" id="export">数据导出</a>
                </div>
            </div>
            <div class="line"></div>
            
            <div class="popUp_c_c">
                <div id="totalRuntimeChart" style="height: 300px;width: 475px;float: left"></div>
                <div id="normalRunTimeChart" style="height: 300px;width: 475px;float: right;"></div>
                <div id="standbyTimeChart" style="height: 300px;width: 475px;float: left;"></div>
                <div id="totalErrorTimeChart" style="height: 300px;width: 475px;float: right;"></div>
            </div>
        </div>
    </div>
  <!--popUp 弹出层 end-->

  </body>
</html>